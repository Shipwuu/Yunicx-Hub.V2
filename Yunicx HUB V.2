-- Step 1: Create the ScreenGui
local existingScreenGui = game:GetService("CoreGui"):FindFirstChild("ShipuHub")
if existingScreenGui then
    existingScreenGui:Destroy() -- Destroy the previous ScreenGui if it exists
end

local ShipuHub = Instance.new("ScreenGui")
ShipuHub.Name = "ShipuHub"
ShipuHub.Parent = game:GetService("CoreGui")

-- Step 2: Create the UltraFrame
local UltraFrame = Instance.new("Frame")
UltraFrame.Name = "UltraFrame"
UltraFrame.Size = UDim2.new(1, 0, 0, 47)  -- Updated size
UltraFrame.Position = UDim2.new(0, 0, 0, -47)  -- Updated position
UltraFrame.BackgroundTransparency = 1
UltraFrame.Parent = ShipuHub

-- Step 3: Create MainFrame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0.4, 0, 0, 47)  -- Initial size (collapsed)
MainFrame.Position = UDim2.new(0.6, 0, 0, 0)  -- Initial position
MainFrame.BackgroundTransparency = 1
MainFrame.Parent = UltraFrame

local MainLayout = Instance.new("UIListLayout")
MainLayout.FillDirection = Enum.FillDirection.Horizontal
MainLayout.Padding = UDim.new(0, 9)
MainLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
MainLayout.VerticalAlignment = Enum.VerticalAlignment.Center
MainLayout.Parent = MainFrame

-- Step 4: Create SecondMainFrame (child of MainFrame)
local SecondMainFrame = Instance.new("Frame")
SecondMainFrame.Name = "ScriptFile"
SecondMainFrame.Size = UDim2.new(0.5, 60, 0, 48)  -- Updated size
SecondMainFrame.Position = UDim2.new(0, 0, 0, 0)  -- Updated position
SecondMainFrame.BackgroundColor3 = Color3.fromRGB(85, 255, 255)
SecondMainFrame.BackgroundTransparency = 0.4
SecondMainFrame.Parent = MainFrame

-- Step 5: Create the SettingUIFrame (also inside MainFrame)
local SettingUIFrame = Instance.new("Frame")
SettingUIFrame.Name = "UISetting"
SettingUIFrame.Size = UDim2.new(0, 58, 0, 48)
SettingUIFrame.Position = UDim2.new(0, 0, 0, 0)
SettingUIFrame.BackgroundColor3 = Color3.fromRGB(85, 255, 255)
SettingUIFrame.BackgroundTransparency = 0.4
SettingUIFrame.Parent = MainFrame

-- Step 6: Create the ToggleUI ImageButton
local ToggleUI = Instance.new("ImageButton")
ToggleUI.Name = "AToggleUI"
ToggleUI.Size = UDim2.new(0, 40, 0, 40)
ToggleUI.Position = UDim2.new(0.57, 0, 0, 4)
ToggleUI.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleUI.BackgroundTransparency = 0.8
ToggleUI.Image = "rbxthumb://type=Asset&id=110719997714211&w=420&h=420" -- Default image
ToggleUI.PressedImage = "rbxthumb://type=Asset&id=129960511211863&w=420&h=420" -- Pressed image
ToggleUI.Parent = UltraFrame

-- Apply UICorner to ToggleUI
local UICornerButton = Instance.new("UICorner")
UICornerButton.CornerRadius = UDim.new(10, 10)
UICornerButton.Parent = ToggleUI

-- Step 7: Animation and Toggle Functionality
local isOpen = true -- Track the toggle state
local TweenService = game:GetService("TweenService")

local function toggleUI()
    if isOpen then
        -- Close the MainFrame (shrink it)
        local closeTween = TweenService:Create(
            MainFrame,
            TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 0, 0, 47)} -- Shrink the width
        )
        closeTween:Play()

        -- Fade out SecondMainFrame and SettingUIFrame (make transparent)
        local fadeTween = TweenService:Create(
            SecondMainFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1}
        )
        fadeTween:Play()

        -- Fade out SecondMainFrame and SettingUIFrame (make transparent)
        local fadeTween = TweenService:Create(
            SettingUIFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1}
        )
        fadeTween:Play()

        -- Wait for the tween to finish and change the image
        closeTween.Completed:Connect(function()
            ToggleUI.Image = "rbxthumb://type=Asset&id=110719997714211&w=420&h=420" -- Reset to the default image
        end)
    else
        -- Open the MainFrame (expand it)
        local openTween = TweenService:Create(
            MainFrame,
            TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {Size = UDim2.new(0.4, 0, 0, 47)} -- Expand to original size
        )
        openTween:Play()

        -- Fade in SecondMainFrame and SettingUIFrame (make opaque)
        local fadeTween = TweenService:Create(
            SecondMainFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {BackgroundTransparency = 0.4}
        )
        fadeTween:Play()

        -- Fade in SecondMainFrame and SettingUIFrame (make opaque)
        local fadeTween = TweenService:Create(
            SettingUIFrame,
            TweenInfo.new(0.5, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out),
            {BackgroundTransparency = 0.4}
        )
        fadeTween:Play()

        -- Wait for the tween to finish and change the image
        openTween.Completed:Connect(function()
            ToggleUI.Image = "rbxthumb://type=Asset&id=129960511211863&w=420&h=420" -- Set to the pressed image
        end)
    end

    -- Toggle the open state
    isOpen = not isOpen
end

-- Connect the ToggleUI ImageButton to toggle functionality
ToggleUI.MouseButton1Click:Connect(toggleUI)

-- Step 8: Draggable Script for Android and PC Devices
local UserInputService = game:GetService("UserInputService")

local dragEnabled = false
local holdStartTime = nil  -- Track the start time of the touch or mouse click
local dragging = false
local startPos = Vector2.new(0, 0)
local lastPos = UDim2.new(0.6, 0, 0, 0)  -- Store the last position of the frame
local currentPos = Vector2.new(0, 0)

-- Function to start dragging
local function onDragStart(input)
    startPos = input.Position
    dragging = false
    holdStartTime = tick()  -- Start timing when the touch begins

    -- Change color to yellow if held for 0.1s
    MainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
end

-- Function to drag the frame
local function onDrag(input)
    if dragging then
        local delta = input.Position - startPos
        MainFrame.Position = UDim2.new(0, delta.X, 0, delta.Y)
    else
        -- Track the hold time
        local holdDuration = tick() - holdStartTime
        if holdDuration >= 0.5 then
            dragging = true
            MainFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0) -- Green if held for 0.5s
        elseif holdDuration >= 0.1 then
            MainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 0) -- Yellow if held for 0.1s
        end
    end
end

-- Function to stop dragging
local function onDragEnd(input)
    dragging = false
    MainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)  -- Reset to white when released

    -- Save the current position when dragging stops
    lastPos = MainFrame.Position
end

-- Connect the input began, changed, and ended events
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragStart(input)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
        onDrag(input)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        onDragEnd(input)
    end
end)
